#!/bin/sh

##############################################################
#
# Benchmark setup for bluespec design
#
# Usage: setup-bmark-smips <srcdir> <destdir> <bmark>
#
# Setup benchmark to run in <destdir> 
#
##############################################################


# 1. Build Benchmark in $destdir
# 2. Create $destdir/run

if [ $# -ne 3 ]; then
   echo Usage $0 "<srcdir> <destdir> <bmark>"
   echo $*
   exit 1
fi

srcdir=$1
destdir=$2
bmark=$3

# echo "BMARK: $bmark"
# echo "SRC: $srcdir"
# echo "DST: $destdir"

echo "Go to $destdir"
cd $destdir

echo "Creating simlinks"
mkdir -p program

/bin/ln -f -s ../../pm/simv .
/bin/ln -f -s ../../pm/simv.daidir

#echo "Linking and making benchmark"
#
#/bin/ln -f -s $MIT6375_HOME/install/smips-bmarks/$bmark/* program
#/bin/ln -f -s $srcdir/Makefile program
#
#make -C program $bmark.smips.vmh

echo "Creating run script"
echo '#!/bin/sh'                                                                   > run
echo "# benchmark run script generated by $0"                                     >> run
#echo "./simv +exe=program/$bmark.smips.vmh +max-cycles=800000 | tee $bmark.smips.out" >> run
echo "./simv +max-cycles=800000 | tee $bmark.smips.out"                           >> run

chmod +x run

exit 0
